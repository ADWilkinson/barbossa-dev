# Development docker-compose configuration
# Use this for local development and testing
# Run with: docker compose -f docker-compose.dev.yml up

services:
  barbossa:
    build: .
    container_name: barbossa-dev
    restart: "no"  # Don't auto-restart in dev
    volumes:
      # Mount source code for development
      - ./src:/app/src
      - ./prompts:/app/prompts
      - ./config:/app/config
      - ./scripts:/app/scripts

      # Persist logs and output
      - ./logs:/app/logs
      - ./changelogs:/app/changelogs
      - ./projects:/app/projects

      # Git config for commits
      - ~/.gitconfig:/home/barbossa/.gitconfig

      # GitHub CLI auth (required)
      - ~/.config/gh:/home/barbossa/.config/gh:ro

      # Claude config (writable for token refresh)
      - ~/.claude:/home/barbossa/.claude
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - TZ=${TZ:-UTC}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - LINEAR_API_KEY=${LINEAR_API_KEY:-}
      # Disable analytics in dev
      - BARBOSSA_ANALYTICS_OPT_OUT=true
    # Override entrypoint for dev - don't start cron
    command: tail -f /dev/null
