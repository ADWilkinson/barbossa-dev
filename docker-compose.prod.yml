services:
  barbossa:
    build: .
    image: barbossa:2.1.3
    platform: linux/amd64
    container_name: barbossa
    restart: unless-stopped
    # Run as host UID with GID=1000 for /app access
    # On Linux: runs as 1000:1000 (default)
    # On macOS: runs as host UID (e.g., 501) with GID 1000
    # This allows writing to /app (group-writable)
    user: "${UID:-1000}:1000"
    volumes:
      # Configuration
      - ./config:/app/config
      # Persist logs and output
      - ./logs:/app/logs
      - ./changelogs:/app/changelogs
      - ./projects:/app/projects
      # Git config for commits (only needed for user.name and user.email)
      - ~/.gitconfig:/home/barbossa/.gitconfig:ro
    environment:
      - TZ=${TZ:-UTC}
      # GitHub authentication (REQUIRED)
      # Generate: gh auth token OR create personal access token at https://github.com/settings/tokens
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      # Claude authentication (REQUIRED - use ONE of the following)
      # Option 1 (Recommended): Claude Pro/Max OAuth token
      #   Generate: claude setup-token
      - CLAUDE_CODE_OAUTH_TOKEN=${CLAUDE_CODE_OAUTH_TOKEN:-}
      # Option 2: Pay-as-you-go API key
      #   Generate: https://console.anthropic.com/settings/keys
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      # Google Analytics 4 (optional - for usage analytics)
      - GA4_API_SECRET=${GA4_API_SECRET:-}
      # Set to 'true' to disable analytics
      - BARBOSSA_ANALYTICS_OPT_OUT=${BARBOSSA_ANALYTICS_OPT_OUT:-false}
